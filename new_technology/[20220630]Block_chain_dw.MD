# Block chain

목적: 블록체인의 원리에 대해서 설명할 수 있다.

## 📃블록체인 개념

- <span style="color:yellow">블록체인이란 P2P 네트워크를 통해 관리되는 분산 데이터베이스의 한 형태로</span>, 거래 정보를 담은 장부를 중앙 서버 한 곳에 저장하는 것이 아니라 <span style="color:yellow">블록체인 네트워크에 연결된 여러 컴퓨터에 저장 및 보관하는 기술</span>로 다양한 분야에 활용이 가능한 기술이다. 블록체인은 분산원장 기술(DLT: Distributed Ledger Technology)이라고도 불리며, 이는 거래 정보를 기록한 원장 데이터를 중앙 서버가 아닌 참가자들이 공동으로 기록 및 관리하는 것을 의미한다.

## 특징
- 블록체인은 분산처리와 암호화 기술을 동시에 적용 -> 높은 보안성을 확보하는 한편 거래과정의 신속성과 투명성을 특징으로 한다. 보안성의 강화로 해커의 공격과 데이터의 왜곡 그리고 기존 중앙집중 서버 방식(Central Server)에서 가장 큰 문제인 디도스 공격을 원천적으로 방어할 수 있다.
-> 보안성이 높고 위, 변조가 어렵다.

- 블록체인 플랫폼을 이용하면 제3자의 거래에 의존하던 여러 과정들을 생략할 수 있어, 그에 따른 비용을 획기적으로 절약할 수 있다. 제 3자가 거래 중심의 보장 및 증명서비스의 항목들을 블록체인 시스템에 수렴할 수 있다.

## 💻<span style="color:yellow">블록체인의 기술적 개념</span>
- 해시 함수와 머클 트리가 있다.

## 🔑해시함수
- 해시(Hash)는 '어떤 데이터를 고정된 길이의 데이터로 변환'하는 것을 의미한다. 해시함수를 거치면 원본 데이터를 알아볼 수 없도록 특수한 문자열로 변환이 되는데, 해시함수는 압축이 아니라 단방향 변환이기 때문에 해시값을 이용해서 원본 데이터를 복원할 수 없다는 특징을 가지고 있다.

- 해시는 다음과 같은 성격이 있기 때문에 보안에서 유용하게 쓰인다. 원본 데이터에 아주 작은 변화만 있어도 완전히 다른 해시값이 만들어지게 된다. 그래서 해시 함수를 이용하게 되면 원본 데이터의 사소한 변화도 쉽게 확인 가능하다.

### 해시함수의 특성
1. 어떤 길이의 데이터도 입력으로 사용될 수 있다.
2. 결과는 정해진 길이로 나온다.
3. 계산 시간이 합리적으로 추정 가능해야 한다. 
이중에서도 특별히 블록체인에서 실제로 사용되는 특성은 다음과 같다.
4. 결과 값이 중복될 가능성이 거의 없다.
5. 입력 값을 알 수 없다.
6. 결과 값을 알려주고 입력 값을 찾을 수 있는 특별한 공식이 없다.


![image](https://user-images.githubusercontent.com/51036842/176581837-e96ba5c3-430a-4ed8-9263-f4218ca724b2.png)
<그림1 >블록체인 기술에서의 해시 함수 적용 예시

### 해시함수 추가 설명

블록체인을 활용한 암호화폐에서 사용되는 암호기술은 해시(Hash) 함수, 전자서명(Digital Signature), 공개키 암호화(Crypotography) 알고리즘이라 할 수 있다.

여기서 해시함수는 임의 데이터를 특정 길이의 문자, 숫자로 조합된 해시값으로 변환하는 암호 알고리즘의 일종이다. 해시함수에서 산출되는 해시값(Hash Value)은 지문(Fingerprint)이라고도 하는데, 암호화폐에서 해시값 비교(Hash check)를 통하여 원본의 위,변조 여부를 판단하는 무결성 검증에 사용될 수 있다.

블록체인에서는 해시함수를 사용하는 3가지 목적을 보면 <span style="color:yellow">첫째, 해시 함수는 지갑 주소로 활용하여 익명화된 거래를 수행하고, 수행 화폐의 전자지갑 주소는 공개키 기반 암호화 알고리즘에서 생성된 공개키의 해시값을 사용한다.</span> 개인정보(정확히는 송신자의 계좌정보) 없이 익명화된 거래를 통해 송금자의 신원을 감추고, 송금할 수 있다. <span style="color:yellow">둘째, 해시함수를 사용하여 2가지의 무결성 검증에 사용하게 된다.</span> 체인으로 연결된 블록헤더의 해시값을 활용하여, 해시값 체인으로 연결된 블록의 무결성 검증에 사용된다. 또 다른 무결성 검증은 각 블록의 전체 거래를 하나의 해시값(머클 루트)으로 저장하고, 필요한 경우에는 언제든, 해당 블록의 머클 루트 값으로, 블록 내에 포함된 개별 거래의 위,변조 여부를 검증할 수 있다. 모든 거래 데이터의 해시값을 머클 트리(Merkle Tree)를 이용하여 만들어지는 머클 루트(Merkle Root)에 저장하고, 향후 거래내역의 위,변조 여부를 검증할 때, 원본 해시값과 비교를 통하여, 각 거래의 무결성을 검증할 수 있다.
 또한 머클 루트는 1MB로 크기가 제한되어 있는 비트코인의 각 블록의 크기를 효율적으로 사용할 수 있게 한다. 전체 거래내역을 다 저장할 필요 없이, 머클 루트라는 한 개의 해시값만 저장하면, 해당 블록 내의 모든 거래내역의 진위를 필요할 때 비교할 수 있기 때문이다. <span style="color:yellow">마지막으로 합의 알고리즘에서 PoW(Proof of Work)방식을 사용할 경우, 해시값을 활용한 채굴문제에 활용한다.</span> 해시캐시(Hashcash) 문제풀이를 통한 작업 증명(PoW)은 채굴(Mining)이라고도 하는데, 채굴자에 대한 보상을 통해, 채굴을 경쟁하고, 채굴자가 자율적으로 새로운 블록을 생성하도록 유도할 수 있는 원리를 가지고 있다.

## 🎄머클 트리

#### 1) 블록체인(Blockchain)하에 머클 트리 특징
 - 거래내역을 확인하기 위해 전체 트랜잭션(거래)를 조회하는 건 비효율적이다.
- 특정 트랜잭션의 위,변조 여부를 빠르고 효율적으로 조회할 수 있어야 하는데 이에 따라 등장한 방식이 머클 트리 방식이다.

![image](https://user-images.githubusercontent.com/51036842/176584865-16d63a14-c622-4a56-a5a0-64a526a3d7d5.png)
<그림 2> 블록체인 기술에서의 블록 구조 및 알고리즘

블록은 블록의 정체성을 띠는 데이터를 가진 블록헤더, 해당 블록에 거래의 개수를 알려주는 거래 카운터, 그리고 가장 많은 공간을 차지하는 거래 목록들이 있다.

그중에서도 블록헤더는 아래 3가지로 구성되어 있다고 볼 수 있다.
1. 현재 블록이 이전(Previous) 블록과 연결되어 있음을 나타내는 이전 블록의 해시값을 포함한다는 부분
2. 난이도, 타임스탬프, 난스 등 채굴 경쟁과 직접적 연관이 되는 부분
3. 머클 루트(Merkle Root)

1은 블록이 이전 블록과 연결되어 있다는 것을 나타내며 해당 블록을 식별하는 것이고, 2는 채굴자들이 연산을 통해 블록을 채굴하는 데 연관된 것들이다. 마지막으로 3의 머클 루트(Merkle Root)란 머클 트리(Merkle Trees)에서 뿌리 부분에 해당하는 것으로, 해당 블록에 있는 모든 거래내역(수백에서 수천가지의 거래량)을 요약하여 작은 사이즈의 용량으로 블록헤더에 존재하는 데이터이다.

![image](https://user-images.githubusercontent.com/51036842/176586829-d836b488-88d2-4dc6-8cf1-3fcd567141dd.png)

- 위 그림은 단순하게 8개의 거래로 묶어 예를 든 것이다. 8개뿐만 아니라 몇 개의 거래 데이터가 있든 하나의 루트로 만들 수 있다. 이 과정은 그림처럼 두 개씩 거래를 묶은 다음 SHA 256 알고리즘을 통해 해시값으로 나타내고 또 그렇게 묶은 값들을 다시 두 개씩 묶어서 해싱하여 수백 개의 거래 값들을 그림 가장 꼭대기에 위치한 하나의 데이터로 만들어 주는 것이다.

- 이렇게 두 개씩 묶어서 올라가면 좋은 점은 거래량이 기하급수적으로 늘어나도 특정 거래를 찾는 경로는 단순하다는 것이다. 거래의 건수인 N이 증가할 때마다 특정 거래의 경로를 찾는 경우의 수는 log2(N)으로 늘어나기 때문이다.

- 블록체인의 용량은 시간이 지날수록 지속적으로 늘어가기 때문에 이제는 성능이 좋은 컴퓨터만 모든 블록체인을 다운받는 'Full Node가 될 수 있는데, 이 머클 트리의 이진 트리 방식은 우리가 가지고 다니는 모바일로도 블록데이터의 일부만 다운받는 'Light Node'로서 쉽고 빠르게 특정 거래를 찾도록 해준다.

2) 머클 트리 방식에 대표적으로 사용되는 기술
1. SHA256(Scure Hash Algorithm): 어떠한 입력값이 들어와도 항상 고정된 크기(256bit)의 데이터를 반환하는 해시함수이다.
2. Binary Tree(이진 트리): 트랜잭션의 해시(거래내역)를 두 개씩 묶어 또 다른 해시를 만들어내는 알고리즘이 사용된다.

3) 예시를 통한 머클 트리 작동 방식
가정: 비트코인 블록체인의 특정 브록(100번 블록)안에는 트랜잭션(A~P)이 존재하고 있다.
 실제 구현: 각 트랜잭션들은 CTransaction 클래스의 1차원 vector로 CBlock 내에 저장되어 있다.

 ![image](https://user-images.githubusercontent.com/51036842/176588738-6216d494-e45b-4537-ab08-bd135e90d93b.png)

 가지고 있는 트랜잭션 중 트랜잭션 K( 녹색 표시)의 위,변조가 의심되어 위 변조 여부를 조사하려 한다. 이때 필요한 정보는 파란색으로 칠해진 4개의 해시값(H_L, H_IJ, H_ABCDEFGH), 그리고 머클 루트이다.
 각 트랜잭션들의 해시(uint 256: SHA256)저장하기 위해 vector<uint256> vMerkleTree가 존재한다.

---

## 추가 정보

## 블록체인의 유형
블록체인은 활용되는 목적에 따라 3가지 종류로 나뉘며 각 블록체인마다 특징이 있다.
이는 Public, Consortium, Private 이 있으며 우리가 통상 블록체인이라고 하면 Public Blockchain이다.

 <span style="color:yellow">퍼블릭 블록체인(Public Blockchain)</span>은 개방형 블록체인으로 누구나 트랜잭션을 생성할 수 있어 앞에서 설명한 공공거래장부에 해당한다.퍼블릭 블록체인은 누구나 참여할 수 있고 모든 참여자의 상호 검증을 거쳐 신뢰도가 높다. 트랜잭션 내역이 모두에게 공개되어 네트워크에 모든 노드(Node)가 이를 검증하고 거래를 승인하기 때문이다.

나머지는 다음 표를 보고 비교하자.

|구분|Public Blockchain|Consortium Blockchain|Private Blockchain|
|--|--|--|--|
|관리자|모든 거래 참여자|컨소시엄에 소속된 참여자|한 중앙 기관이 만든 권한 보유|
|거버넌스|한번 정해진 법칙을 바꾸기 매우 어려움|컨소시엄 참여자들의 합의에 따라 법칙을 바꿀 수 있음|중앙 기관의 의사결정에 따라 용이하게 법칙을 바꿀 수 있음|
|거래속도|네트워크 확장이 어렵고 거래 속도가 느림|네트워크 확장이 쉽고 거래 속도가 빠름|네트워크 확장이 매우 쉽고 거래 속도가 빠름|
|데이터 접근|누구나 접근 가능|허가 받은 사용자만 접근 가능|허가 받은 사용자만 접근 가능|
|식별성|익명성|식별가능|식별가능|
|거래증명|PoW, PoS등 알고리즘에 따라 거래 증명자가 걸졍됨, 거래 증명자가 누구인지 사전에 알 수 없음|거래 증명자가 인증을 거쳐 알려진 상태 사전에 합의된 규칙에 따라 거래 검증 및 블록 생성이 이루어짐|중앙 기관에 의하여 거래 증명이 이루어짐|
|활용사례|비트코인|R3 CEV|나스닥 비상장 주식 거래소 플랫폼인 링크(Linq)|

(자료: 김신정,김하은,염용진(2017.6))

### 블록체인 컨소시엄

블록체인 기술은 거래가 가능한 대부분의 자산에 적용이 가능하므로 다방면에 걸쳐 다양한 형태로 검토 중이며, 블록체인의 개발은 주로 컨소시엄 형태로 플랫폼 개발이 이루어지고 있고 주요 컨소시엄은 다음과 같다.

|컨소시엄|참가기관|주요 특징|
|--|--|--|
|R3 컨소시엄|- 60여 개 대형 해외 메이저 금융 회사, 국내 5개 은행(국민,신한,KEB,하나,기업, 우리|금융회사 계약 기록 관리 시스템(Conda) 개발, 대량 금액 및 국가 간 거대 자본 이체|


이외 Hyperledger, SBi 컨소시엄, FidoLedger 등 컨소시엄이 있다.

### 참고 자료
- https://www.kiri.or.kr/pdf/%EC%97%B0%EA%B5%AC%EC%9E%90%EB%A3%8C/%EC%97%B0%EA%B5%AC%EB%B3%B4%EA%B3%A0%EC%84%9C/nre2018-24_02.pdf