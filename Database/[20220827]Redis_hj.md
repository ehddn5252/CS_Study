<img width= "100%" height="200px" src=https://user-images.githubusercontent.com/87989933/187015321-0a23c017-df5e-4eb3-895a-91580bfafb62.png>

# Redis란??

레디스(Redis)는 Remote Dictionary SErver의 약자로서, **"Key-Value" 구조의 비정형 데이터를 저장하고 관리하기 위한 오픈소스 기반의 비관계형 데이터베이스 관리 시스템(DBMS)이다.**  
인메모리 상태에서 데이터를 처리함으로써 흔히 사용하는 관계형 데이터베이스(RDS) 그리고 몽고 DB로 대표되는 문서형(Document) 데이터베이스보다도 빠르고 가볍게 동작한다.

<br/>

## 캐시 서버 (Cache Server)

DB가 있는데도 Redis라는 인메모리 데이터 구조 저장소를 사용하는 이유는??

DB는 데이터를 물리 디스크에 직접 쓰기 때문에, 서버에 문제가 발생하여 다운되더라도 데이터가 손실되지 않는다. 하지만, 매번 디스크에 접근해야 하기 때문에 사용자가 많아질수록 부하가 많아져서 느려질 수 있다.
일반적으로 서비스 운영 초반이거나 규모가 작은, 사용자가 많지않은 서비스의 경우에는 WEB - WAS - DB의 구조로도 DB에 무리가 가지않지만, 사용자가 많아지면 데이터베이스가 과부하 될 수 있기때문에, 캐시서버를 도입하여 사용한다.

캐시는 한번 읽어온 데이터를 임의의 공간에 저장하여 다음에 읽을 때는 빠르게 결과값을 받을 수 있도록 도와주는 공간이다. 같은 요청이 여러번 들어오는 경우 매번 데이터베이스를 거치지 않고, 캐시서버에서 첫번째 요청이후 저장된 결과값을 바로 내려주기 때문에 DB의 부하를 줄이고 서비스의 속도도 느려지지 않는 장점이 있다.

## 캐시서버 패턴

### Look aside cache

1. 클라이언트가 데이터를 요청
2. 웹서버는 데이터가 존재하는지 Cache 서버에 먼저 확인
3. Cache 서버에 데이터가 있으면 DB에 데이터를 조회하지 않고 Cache 서버에 있는 결과값을 클라이언트에게 바로 반환 (Cache Hit)
4. Cache 서버에 데이터가 없으면 DB에 데이터를 조회하여 Cache 서버에 저장하고 결과값을 클라이언트에게 반환 (Cache Miss)

### Write Back

1. 웹서버는 모든 데이터를 Cache 서버에 저장
2. Cache 서버에 특정 시간 동안 데이터가 저장됨
3. Cache 서버에 있는 데이터를 DB에 저장
4. DB에 저장된 Cache 서버의 데이터를 삭제

\* 쿼리를 500번 날리지 않고, 500개를 붙여서 한번에 날리는 것이 효율적이라는 원리  
\* 이 방식은 들어오는 데이터들이 저장되기 전에 메모리 공간에 머무르는데 이때 서버에 장애가 발생하여 다운된다면 데이터가 손실될 수 있다는 단점이 있다.

<br/>

## 레디스를 사용할때 2가지 방법

1. 로컬 환경에서 레디스를 호출한다.  
   AWS EC2를 예로 인스턴스에 레디스를 설치해 인스턴스 메모리를 사용해 레디스를 사용한다. 인스턴스의 메모리여유가 있다면 비용적인 측면으로나 사용성 측면으로 뛰어나다.

2. 클라우드 서비스를 사용해 외부 자원을 사용한다.  
   레드시 랩등의 서드파티 서비스를 사용해 레디스를 사용하게되면, 통신하는 웹 서버가 아무리 많아도 하나의 프레임워크 바인딩을 사용할 수 있다. 이 경우 레디스는 여러 웹 서버들의 공유 메모리 역할을 감당할 수 있다.

<br/>

## 언제 Redis를 사용할까?

운영중인 웹 서버에서 키-값 형태의 데이터 타입을 처리해야하고, I/O가 빈번히 발생해 다른 저장 방식을 사용하면 효율이 떨어지는 경우 사용한다.

### 조회수와 같은 카운트 형태의 I/O가 빈번한 데이터

- 레디스를 사용해 데이터를 캐싱처리하고, 일정한 주기에 따라 RDS에 업데이트하면, RDS에 가해지는 부담을 크게 줄이고, 성능은 크게 향상할 수 있다.

### 사용자의 세션 관리

- 사용자의 세션을 유지하고, 불러오고, 여러 활동들을 추적하는게 매우 효과적으로 사용할 수 있다.

### API 캐싱

- 라우트로 들어온 요청에 대해 요청값을 캐싱하면, 동일 요청에 대해 캐싱된 데이터를 리턴하는 방식이다.

<br/>

## 레디스의 데이터 구조

1. 문자열 (String) : 가장 일반적인 key - value 구조의 형태
2. 해시 (Hash)
3. 리스트 (List)
4. 셋 (Set)
5. 정령된 셋 (Sorted Set)

<br/>

## 레디스 스키마

레디스의 스키마는 **데이터를 정규화하고, 데이터의 로우에 대해 일관된 레퍼런스를 가질 수 있게 해주는 용도**로 존재한다.

ex) 사용자의 이메일, 닉네임, 최근 로그인 시간을 레디스에 저장

- user:userId:email:문자열
- user:userId:nickname:문자열
- user:userId:lastLogin:문자열

스키마를 활용하면 사용자 아이디에 해당하는 userId만 알아도 연결된 데이터인 email, nickname, lastLogin을 알 수 있다.

<br/>

## 레디스 키 삭제

레디스는 한번 생성한 키를 선택적으로 삭제하기 어렵다.

1. 일괄 삭제 - **FLUSHDB 명령어**를 통해 모든 키를 삭제한다.

2. 일정시간 이후 삭제 - 키를 저장할때 셋에 저장해 특정 시간이나 조건에 따라 삭제하는 방법으로, 실제 삭제라기보다 밀어내기의 방법이다.

3. 기간 만료 후 삭제 - 가장 많이 사용되는 방법으로, 키를 추적할 필요없이 쉽게 관리할 수 있다. key-value를 set 커맨드로 저장하여 expire커맨드로 기간만료시간을 설정하는 방법이다.

## 레디스 주의사항

- Single Thread  
  레디스는 Single Thread이기 때문에 한번에 하나의 명령만 처리할 수 있다. 그래서 중간에 처리시간이 긴 명령이 들어오면, 그 뒤에 명령들은 모두 앞의 명령이 끝날때 까지 대기해야한다.
- 서버에 장애가 발생했을 경우  
  인메모리 데이터 저장소의 특성상, 서버에 장애가 발생했을 경우 데이터 유실이 발생할 수 있다.
