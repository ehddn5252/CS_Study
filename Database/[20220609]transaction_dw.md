# Transaction

학습 목표: 트랙잭션은 단어에 대한 정의와 어떠한 경우 사용하는 지, 그리고 트랜잭션의 특징에 대해서 
알아두자.

---

## 트랜잭션의 정의
트랜잭션은 <span style="color:yellow">쪼갤 수 없는 업무 처리의 최소 단위</span>로, 데이터베이스에서는 하나의 논리적 기능을 수행하기 위한 작업의 단위를 말한다. 

데이터베이스에 접근하는 방법은 쿼리이므로, 즉<span style="color:yellow"> **여러 개의 쿼리들을 하나로 묶는 단위**</span>를 말합니다. 이에 대한 특징은 원자성, 일관성, 독립성, 지속성이 있으며 이를 한꺼번에 ACID 특징이라고 합니다.

## 사용하는 경우
트랜잭션을 사용하는 경우는 말 그대로 업무를 쪼갤 수 없을 때 이를 하나로 묶이 위해서 사용한다. 예를 들어서 동우가 현우에게 1억을 송금한다고 하면 다음과 같은 과정이 일어난다고 생각할 수 있다.
1. 동우의 통장에서 1억을 출금한다, or 출금으로 표시한다. 
2. 현우의 통장에 1억을 입금된다, or 입금된다고 표시한다.

1번의 과정으로 1억이 출금되고 2번이 일어나기 전에 에러가 생긴다면 동우의 1억은 그냥 없어졌다고만 표시가 되어 없어져버린다. 이러한 경우가 대표적인 예시이다.


## 트랜잭션의 특징

### **원자성(Atomicity)**
>"all or nothing"

원자성(atomicity)은 <span style="color:yellow">트랜잭션과 관련된 일이 모두 수행되었거나 되지 않았거나를 보장</span>하는 특징이다. 예를 들어 트랜잭션을 커밋했는 데, 문제가 발생하여 롤백하는 경우 그 이후에 모두 수행되지 않음을 보장하는 것을 말한다.

#### 주의점
트랜잭션 단위로 여러 로직을 묶을 떄 외부 API를 호출하는 것이 있으면 안됩니다. 만약 있다며 롤백이 일어났을 때 어떻게 해야 할 것인지에 대한 해결 방법이 있어야 하고 트랜잭션 전파를 신경써서 관리해줘야 합니다.

### **일관성(consistency)**
일관성은 <span style="color:yellow">**'허용된 방식' 으로만 데이터를 변경해야 하는 것**</span>을 의미합니다. 데이터베이스에 기록된 모든 데이터는 여러 가지 조건, 규칙에 따라 유효성을 가져야 합니다. 예를 들어 우성이는 1000만원이 있고 유민이는 0원이 있다고하면 범석이가 300만원을 우성이에게 입금할 수 있을까요? 이는 불가능 합니다. 0원에서 300만원이 나오는 것은 불가능하기 때문입니다.

### **격리성 (isolation)**
격리성은 <span style="color:yellow">**트랜잭션 수행 시 서로 끼어들지 못하는 것**</span>을 말합니다. 복수의 병렬 트랜잭션은 서로 격리되어 마치 순차적으로 실행되는 것처럼 작동되어야 하고, 데이터베이스는 여러 사용자가 같은 데이터에 접근할 수 있어야 한다. 그냥 순차적으로 하면 쉽게 되겠지만 그렇게 하면 성능이 나쁠 것이다.

### **지속성 (durablitiy)**
지속성은<span style="color:yellow">**성공적으로 수행된 트랜잭션은 영원히 반영되어야 한다는 것**</span>을 의미합니다. 이는 데이터베이스에 시스템 장애가 발생해도 원래 상태로 복구하는 회복 기능이 있어야 함을 뜻하며 데이터베이스는 이를 위해 체크섬, 저널링, 롤백 등의 기능을 제공합니다.

- 체크섬
    - 중복 검사의 한 형태로, 오류 정정을 통해 송신된 자료의 무결성을 보호하는 단순한 방법
- 저널링
    - 파일 시스템 또는 데이터베이스 시스템에 변경 사항을 반영(commit)하기 전에 로깅하는 것, 트랜잭션 등 변경 사항에 대해 로그를 남기는 것

## 무결성
무결성이란 데이터의 정확성, 일관성, 유효성을 유지하는 것을 말하며, **무결성이 유지되어야 데이터베이스에 저장된 데이터 값과 그 값에 해당하는 현실 세계의 실제 값이 일치하는지에 대해 신뢰가 생깁니다**. 무결성의 종류는 다음과 같다.
|이름|설명|
|--|---|
|개체무결성|기본키로 선택된 필드는 빈 값을 허용하지 않는다.|
|참조 무결성|서로 참조 관계에 있는 두 테이블의 데이터는 항상 일관된 값을 유지해야 한다.|
|고유 무결성|특정 속성에 대해 고유한 값을 가지도록 조건이 주어진 경우 그 속성 값은 모두 고유한 값을 가진다.|
|NULL 무결성|특정 속성 값에 NULL이 올 수 없다는 조건이 주어진 경우 그 속성 값은 NULL이 될 수 없다는 제약조건이다.|